# MediFinance Pro v2 - 개발 할일 목록 (ToDo List)

## 📋 프로젝트 개요
**목표**: 병원 재무담당자의 4-6시간 수작업을 12분 자동화 프로세스로 대체  
**핵심**: 로우데이터 자동 계정 분류 + Excel 수식 로직 웹 재현  
**기간**: 6-7일 (Phase별 조정 가능)

---

## 🔥 Phase 1: 자동화 Excel 완전 분석 (2일) - 최우선

### Day 1: Excel 구조 분석
- [ ] **1.1** 자동화 Excel 파일 획득 및 백업
- [ ] **1.2** 전체 워크시트 구조 문서화
  - [ ] 입력 시트 식별 및 구조 분석
  - [ ] 계산 시트들 식별 및 역할 파악
  - [ ] 출력 시트들 (손익계산서, 재무상태표 등) 분석
- [ ] **1.3** 3,950개 수식 전체 추출 및 분류
  - [ ] ExcelJS 라이브러리를 사용한 수식 추출 스크립트 작성
  - [ ] 수식을 카테고리별로 분류 (IF, VLOOKUP, SUMIF, 계산식 등)
  - [ ] 각 카테고리별 수식 개수 및 복잡도 분석
- [ ] **1.4** 시트간 참조 관계 매핑
  - [ ] 시트간 의존성 그래프 작성
  - [ ] 데이터 플로우 순서 정의
  - [ ] 순환 참조 여부 확인

### Day 2: 분류 로직 및 수식 분석
- [ ] **2.1** 입력 시트의 계정과목 구조 분석
  - [ ] 필수 입력 필드 목록 작성
  - [ ] 선택 입력 필드 목록 작성
  - [ ] 데이터 검증 규칙 (Data Validation) 추출
  - [ ] 계정과목 코드 체계 분석
- [ ] **2.2** 수작업 분류 규칙 완전 추출 🔥 핵심
  - [ ] 환자 유형별 분류 규칙 (건보/의보/일반/산재/자보)
  - [ ] 진료과별 분류 규칙 (내과/외과/소아과 등)
  - [ ] 비용 항목별 분류 규칙 (약품비/재료비/인건비 등)
  - [ ] 특수 케이스 및 예외 처리 규칙
- [ ] **2.3** 복잡한 수식 분해 및 변환 준비
  - [ ] 중첩 IF문 분해 및 로직 트리 작성
  - [ ] VLOOKUP 테이블 및 매칭 규칙 분석
  - [ ] SUMIF 조건 및 집계 로직 분석
  - [ ] 날짜/시간 함수 사용 패턴 분석
- [ ] **2.4** JavaScript 변환 가능성 검증
  - [ ] 각 Excel 함수의 JavaScript 대응 방안 정리
  - [ ] Formula.js 라이브러리 호환성 확인
  - [ ] 커스텀 구현이 필요한 함수 목록 작성

---

## 🔥 Phase 2: AI 자동 분류 엔진 구현 (2일) - 핵심

### Day 3: 분류 엔진 핵심 구현
- [ ] **3.1** 프로젝트 구조 및 환경 설정
  - [ ] backend/src/services/ 디렉토리 구조 생성
  - [ ] 필요한 npm 패키지 설치 (ExcelJS, Formula.js 등)
  - [ ] TypeScript 인터페이스 정의
- [ ] **3.2** 로우데이터 파싱 및 전처리 구현
  - [ ] Excel/CSV 파일 읽기 모듈 구현
  - [ ] 데이터 정규화 및 정제 로직 구현
  - [ ] 누락 데이터 및 오류 데이터 처리
- [ ] **3.3** 환자 유형별 자동 분류 알고리즘 구현
  - [ ] `patientTypeRules.ts` 구현
  - [ ] 건강보험 분류 로직 구현
  - [ ] 의료보험 분류 로직 구현
  - [ ] 일반환자 분류 로직 구현
  - [ ] 산재/자보 분류 로직 구현
- [ ] **3.4** 진료과별 분류 규칙 엔진 구현
  - [ ] `departmentRules.ts` 구현
  - [ ] 진료과 코드 매핑 테이블 구현
  - [ ] 진료과별 수익/비용 분류 로직
- [ ] **3.5** 비용 항목별 분류 규칙 구현
  - [ ] `expenseRules.ts` 구현
  - [ ] 약품비 자동 분류 로직
  - [ ] 의료재료비 자동 분류 로직
  - [ ] 인건비 자동 분류 로직
  - [ ] 기타 비용 분류 로직
- [ ] **3.6** 분류 신뢰도 계산 시스템 구현
  - [ ] 각 분류별 신뢰도 점수 계산 알고리즘
  - [ ] 불확실한 케이스 임계값 설정
  - [ ] 사용자 검토 필요 케이스 식별 로직

### Day 4: 검증 및 최적화
- [ ] **4.1** 테스트 데이터 준비 및 분류 테스트
  - [ ] 샘플 로우데이터 준비 (다양한 케이스 포함)
  - [ ] 분류 엔진 단위 테스트 작성
  - [ ] 통합 테스트 시나리오 작성 및 실행
- [ ] **4.2** 분류 정확도 측정 및 개선
  - [ ] 분류 결과와 실제 정답 비교 시스템 구현
  - [ ] 정확도 측정 메트릭 구현 (Precision, Recall, F1-Score)
  - [ ] 오분류 케이스 분석 및 규칙 개선
  - [ ] 목표 정확도 95% 달성 확인
- [ ] **4.3** 성능 최적화
  - [ ] 대용량 데이터 처리를 위한 청크 단위 처리 구현
  - [ ] 병렬 처리 로직 구현
  - [ ] 메모리 사용량 최적화
  - [ ] 처리 속도 벤치마크 및 개선
- [ ] **4.4** 분류 결과 검증 시스템 구현
  - [ ] `validationService.ts` 구현
  - [ ] 분류 결과 품질 검증 로직
  - [ ] 이상치 탐지 및 알림 시스템
  - [ ] 분류 결과 리포트 생성 기능

---

## 🔥 Phase 3: Excel 수식 실행 엔진 구현 (1-2일)

### Day 5: 수식 엔진 핵심 구현
- [ ] **5.1** Excel 수식 파싱 엔진 구현
  - [ ] `formulaParser.ts` 구현
  - [ ] Excel 수식 → AST(Abstract Syntax Tree) 변환
  - [ ] 한국어 Excel 함수명 대응 테이블 구현
  - [ ] 수식 구문 분석 및 검증
- [ ] **5.2** 기본 Excel 함수 구현
  - [ ] IF, IFS, SWITCH 조건부 함수 구현
  - [ ] SUM, AVERAGE, COUNT 기본 집계 함수 구현
  - [ ] VLOOKUP, INDEX, MATCH 조회 함수 구현
  - [ ] SUMIF, SUMIFS, COUNTIF 조건부 집계 함수 구현
- [ ] **5.3** 고급 Excel 함수 구현
  - [ ] 날짜/시간 함수 (TODAY, NOW, YEAR, MONTH 등)
  - [ ] 텍스트 함수 (LEFT, RIGHT, MID, CONCATENATE 등)
  - [ ] 수학 함수 (ROUND, ABS, MAX, MIN 등)
  - [ ] 논리 함수 (AND, OR, NOT 등)
- [ ] **5.4** 시트간 참조 및 연동 로직 구현
  - [ ] `sheetConnector.ts` 구현
  - [ ] 시트간 셀 참조 처리
  - [ ] 순환 참조 탐지 및 처리
  - [ ] 의존성 기반 계산 순서 관리
- [ ] **5.5** 계산 엔진 및 진행률 표시
  - [ ] `calculationEngine.ts` 구현
  - [ ] 실시간 계산 진행률 추적
  - [ ] WebSocket을 통한 실시간 진행률 업데이트
  - [ ] 계산 오류 처리 및 복구

### Day 6 (선택): 고급 기능 및 최적화
- [ ] **6.1** 중첩 수식 및 배열 함수 처리
  - [ ] 복잡한 중첩 수식 처리 로직 개선
  - [ ] 배열 수식 지원 (Array Formula)
  - [ ] 동적 배열 함수 구현
- [ ] **6.2** 성능 최적화 및 캐싱
  - [ ] 계산 결과 캐싱 시스템 구현
  - [ ] 증분 계산 (Incremental Calculation) 지원
  - [ ] 병렬 계산 처리 최적화
- [ ] **6.3** Excel과 결과 동일성 검증
  - [ ] 계산 결과 비교 시스템 구현
  - [ ] 차이점 분석 및 리포팅
  - [ ] 자동 오류 수정 제안 시스템
- [ ] **6.4** 오류 처리 및 예외 상황 대응
  - [ ] 계산 오류 유형별 처리 로직
  - [ ] 사용자 친화적 오류 메시지
  - [ ] 오류 복구 및 대안 제시

---

## 🎨 Phase 4: 웹 대시보드 및 리포트 (1일)

### Day 7: UI/UX 구현
- [ ] **7.1** 파일 업로드 및 진행률 표시 UI
  - [ ] 로우데이터 Excel 파일 업로드 인터페이스
  - [ ] 드래그 앤 드롭 파일 업로드 구현
  - [ ] 실시간 분류 진행률 표시 (Progress Bar + 상세 정보)
  - [ ] 실시간 계산 진행률 표시 ("수식 실행 중... 2,341/3,950")
- [ ] **7.2** 분류 결과 대시보드 구현
  - [ ] 계정과목별 집계 결과 테이블 구현
  - [ ] 환자 유형별 수익 분포 차트 (Chart.js/D3.js)
  - [ ] 진료과별 수익/비용 분석 차트
  - [ ] 월별/분기별 트렌드 분석 차트
- [ ] **7.3** 재무제표 웹 표시 구현
  - [ ] 손익계산서 웹 렌더링
  - [ ] 재무상태표 웹 렌더링
  - [ ] 각종 분석 리포트 표시
  - [ ] 전년 동기 대비 분석 표시
- [ ] **7.4** Excel/PDF 리포트 다운로드 기능
  - [ ] 기존 Excel 형식과 동일한 리포트 생성
  - [ ] PDF 변환 및 다운로드 기능 (Puppeteer/jsPDF)
  - [ ] 커스텀 리포트 템플릿 지원
- [ ] **7.5** Excel 원본과 비교 검증 화면
  - [ ] Side-by-side 결과 비교 UI
  - [ ] 차이점 하이라이트 표시
  - [ ] 불일치 항목 상세 분석 화면
  - [ ] 분류 정확도 및 신뢰도 표시

---

## 🔧 기술적 구현 세부사항

### 데이터베이스 스키마 구현
- [ ] **DB.1** 기존 테이블 확장
  - [ ] users, hospitals, raw_data_files 테이블 검토
  - [ ] 필요한 컬럼 추가 및 인덱스 최적화
- [ ] **DB.2** 새 테이블 생성
  - [ ] classification_rules 테이블 생성
  - [ ] account_mappings 테이블 생성
  - [ ] classification_results 테이블 생성
  - [ ] excel_formulas 테이블 생성 (수식 저장용)
- [ ] **DB.3** 마이그레이션 스크립트 작성
  - [ ] 기존 데이터 백업 및 마이그레이션
  - [ ] 테스트 데이터 시드 스크립트 작성

### API 엔드포인트 구현
- [ ] **API.1** 파일 업로드 API
  - [ ] POST /api/upload/raw-data - 로우데이터 업로드
  - [ ] 파일 검증 및 저장 로직
- [ ] **API.2** 분류 처리 API
  - [ ] POST /api/classify/start - 분류 시작
  - [ ] GET /api/classify/progress/:id - 진행률 조회
  - [ ] GET /api/classify/result/:id - 분류 결과 조회
- [ ] **API.3** 계산 처리 API
  - [ ] POST /api/calculate/start - 수식 계산 시작
  - [ ] GET /api/calculate/progress/:id - 계산 진행률 조회
  - [ ] GET /api/calculate/result/:id - 계산 결과 조회
- [ ] **API.4** 리포트 생성 API
  - [ ] GET /api/report/dashboard/:id - 대시보드 데이터
  - [ ] GET /api/report/excel/:id - Excel 리포트 다운로드
  - [ ] GET /api/report/pdf/:id - PDF 리포트 다운로드

### 프론트엔드 컴포넌트 구현
- [ ] **FE.1** 공통 컴포넌트
  - [ ] ProgressBar 컴포넌트 (실시간 진행률)
  - [ ] FileUpload 컴포넌트 (드래그앤드롭)
  - [ ] DataTable 컴포넌트 (정렬/필터링)
  - [ ] Chart 컴포넌트 (다양한 차트 타입)
- [ ] **FE.2** 페이지별 컴포넌트
  - [ ] UploadPage 컴포넌트
  - [ ] ClassificationProgress 컴포넌트
  - [ ] CalculationProgress 컴포넌트
  - [ ] DashboardPage 컴포넌트
  - [ ] ReportPage 컴포넌트
  - [ ] ComparisonPage 컴포넌트

---

## 🧪 테스트 및 품질 보증

### 단위 테스트
- [ ] **TEST.1** 분류 엔진 테스트
  - [ ] 환자 유형별 분류 로직 테스트
  - [ ] 진료과별 분류 로직 테스트
  - [ ] 비용 항목별 분류 로직 테스트
  - [ ] 신뢰도 계산 로직 테스트
- [ ] **TEST.2** 수식 엔진 테스트
  - [ ] 기본 Excel 함수 테스트
  - [ ] 복잡한 중첩 수식 테스트
  - [ ] 시트간 참조 테스트
  - [ ] 오류 처리 테스트

### 통합 테스트
- [ ] **TEST.3** 전체 프로세스 테스트
  - [ ] 파일 업로드 → 분류 → 계산 → 리포트 전체 플로우
  - [ ] 다양한 데이터 크기별 성능 테스트
  - [ ] 동시 사용자 처리 테스트
- [ ] **TEST.4** 정확도 검증 테스트
  - [ ] Excel 원본 결과와 시스템 결과 비교
  - [ ] 다양한 병원 데이터로 정확도 측정
  - [ ] 엣지 케이스 및 예외 상황 테스트

---

## 📊 모니터링 및 로깅

### 로깅 시스템 구현
- [ ] **LOG.1** 분류 과정 로깅
  - [ ] 각 거래내역별 분류 결과 로깅
  - [ ] 분류 규칙 적용 과정 로깅
  - [ ] 오분류 케이스 상세 로깅
- [ ] **LOG.2** 계산 과정 로깅
  - [ ] 수식별 계산 결과 로깅
  - [ ] 계산 오류 및 예외 로깅
  - [ ] 성능 메트릭 로깅

### 모니터링 대시보드
- [ ] **MON.1** 시스템 성능 모니터링
  - [ ] 분류 정확도 실시간 모니터링
  - [ ] 처리 속도 및 응답 시간 모니터링
  - [ ] 시스템 리소스 사용량 모니터링
- [ ] **MON.2** 사용자 활동 모니터링
  - [ ] 파일 업로드 빈도 및 크기 추적
  - [ ] 사용자별 처리 시간 분석
  - [ ] 오류 발생 패턴 분석

---

## 🚀 배포 및 운영

### 배포 준비
- [ ] **DEPLOY.1** 프로덕션 환경 설정
  - [ ] 환경 변수 설정 및 보안 검토
  - [ ] 데이터베이스 프로덕션 설정
  - [ ] 파일 저장소 설정 (AWS S3 등)
- [ ] **DEPLOY.2** CI/CD 파이프라인 구성
  - [ ] GitHub Actions 또는 Jenkins 설정
  - [ ] 자동 테스트 및 배포 스크립트
  - [ ] 롤백 계획 수립

### 사용자 교육 및 문서화
- [ ] **DOC.1** 사용자 가이드 작성
  - [ ] 시스템 사용법 매뉴얼
  - [ ] Excel → 웹 시스템 마이그레이션 가이드
  - [ ] 트러블슈팅 가이드
- [ ] **DOC.2** 개발자 문서 작성
  - [ ] API 문서 (Swagger/OpenAPI)
  - [ ] 시스템 아키텍처 문서
  - [ ] 유지보수 가이드

---

## ✅ 체크포인트 및 성공 기준

### Phase별 완료 조건
- [ ] **Phase 1 완료**: Excel 수식 100% 분석 완료, 분류 규칙 명확화
- [ ] **Phase 2 완료**: 로우데이터 자동 분류 95% 정확도 달성
- [ ] **Phase 3 완료**: Excel 수식 결과와 웹 시스템 결과 99% 일치
- [ ] **Phase 4 완료**: 전체 프로세스 12분 이내 완료, UI 완성

### 최종 검수 항목
- [ ] **FINAL.1** 성능 목표 달성 확인
  - [ ] 4-6시간 → 12분으로 95% 시간 절약 달성
  - [ ] 분류 정확도 95% 이상 달성
  - [ ] 1,000건 데이터 5분 이내 처리 달성
- [ ] **FINAL.2** 사용자 수용 테스트
  - [ ] 실제 병원 데이터로 테스트
  - [ ] 사용자 피드백 수집 및 반영
  - [ ] 시스템 안정성 검증

---

## 📝 참고사항

### 우선순위 표시
- 🔥 **최우선**: 프로젝트 성공의 핵심, 반드시 완료 필요
- ⭐ **중요**: 사용자 경험에 직접적 영향
- 📋 **일반**: 완성도를 위해 필요하지만 조정 가능

### 의존성 관계
- Phase 1 완료 → Phase 2 시작 가능
- Phase 2 완료 → Phase 3 시작 가능
- Phase 3 완료 → Phase 4 시작 가능
- 일부 작업은 병렬 진행 가능 (UI 구현과 API 개발 등)

### 리스크 대응
- Excel 분석 실패 시: 추가 시간 투자 및 전문가 자문
- 분류 정확도 부족 시: 규칙 개선 및 머신러닝 도입 검토
- 성능 문제 시: 아키텍처 재검토 및 최적화

---

**문서 작성일**: 2025년 1월 8일  
**총 예상 작업 항목**: 100+ 개  
**핵심 목표**: 병원 재무 처리 완전 자동화 달성
